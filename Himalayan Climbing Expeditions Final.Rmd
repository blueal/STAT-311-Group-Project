---
title: "Maximizing Elevation in the Himalayas"
author: "Carter Burr, Jack Schreuder, Alex Friedberg"
date: "`r Sys.Date()`"
output: openintro::lab_report
---

```{r load-packages, message=FALSE, echo = FALSE}
library(tidyverse)
library(openintro)
library(broom)
library(lubridate)
library(tidymodels)
expeditions <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/expeditions.csv')
```

## Introduction


SHOULD MAKE AN INTRODUCTION MORE ABOUT THE TOPIC THAN ABOUT THE DATASET, Talk about how we are deciding to just use Everest to keep consistent data, and how it still has enough datapoints. 

This analysis will focus on climbing data for a Himalyan Mountain called 'Cho Oyu'. Cho Oyu is the sixth highest mountain on the planet, with a peak at 8188 meters above sea level. The reason we've chosen this peak is that it is considered to be one of the most accessible peaks in the Himalayas, and as such is a popular destination for climbers of many different skill levels. Note: referring to a 8000+ meter mountain as 'accessible' is a little bit of an oxymoron, but when compared to notoriously difficult mountains like K2 and Everest, the description is fairly accurate. The original data set is incredibly large, and contains data for many mountains, both hundreds of meter taller, and shorter than Cho Oyu. Choosing one mid-to-tall peak allows us to see the true effect of all the variables without being limited by the size of difficulty of other peaks. Additionally, Cho Oyu alone has more than enough data entries to make and educated conclusion about which factors most impact maximum height achieved.

For our final project, we decided to use a dataset compiled by Alex Cookson, where he first posted it to his blog at https://www.alexcookson.com/post/analyzing-himalayan-peaks-first-ascents/ , which we were able to then later find in the tidytuesday
github repository at https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-09-22/readme.md. 

This data was collected by [The Himalayan Database](https://www.himalayandatabase.com/), which is a complication of over 10,000 climbs of over 450 peaks in the Nepal Himalayas starting from 1905 to 2019. The individuals of the data are each different climber that attempted a climb between 1905 and 2019, including the hired helpers that would assist on each climb. When looking at the different variables with this data set, we can see that each expedition and mountain is identified, as well as the year and season with which the climb took place. This data also includes the dates that the expedition left base camp, as well as when they reached their high point and their entire journey was over.  



### Scientific Context

For mountain climbing enthusiasts, there is no greater story to tell than the one of how high they climbed in the Himalayan mountains. But climbing these uniquely enormous mountains is more than just pride, about one quarter of peaks in the Himalayan mountain range have never been climbed before. The human sense of adventure is insatiable, and not even the dangers of altitude sickness, extreme temperatures, and ever changing terrain can dissuade people from trying to climb up these mountains. Given the high level of danger and difficulty involved, it is important for climbers to understand factors that contribute to a successful climb, because if they don't the trip could be deadly for them and their sherpas. So how do climbers achieve the highest height they can? That is what we aim to answer with our analysis of this data.


### Codebook

Name of Variable   | Explanation
-------------------|-------------
expedition_id      | A unique chr that corresponds to each expedition
peak_name          | The name (chr) of the peak that this expedition is climbing
year               | The year (dbl) during which the expedition happened
season             | The season the expedition happend in as a chr, either 'Spring', 'Autumn', 'Winter', or 'Summer'
highpoint_metres   | A dbl expressing the highest point (in meters) the expedition reached before termination
members            | A dbl showing the number of non-hired members in the expedition
member_death       | The number (dbl) of members who died during the expedition
hired_staff        | The number (dbl) of hired staff, aka sherpas, who went on the expedition
hired_staff_deaths | A dbl expressing the number of hired staff who died during the expedition
oxygen_used        | A lgl variable where True means at least one member or hired staff used oxygen at any point, and False means that nobody ever used oxygen
trekking_agency    | The chr name of trekking agency from which the hired staff where hired. Appears as NA if no staff were hired


### Glimpse of our data
```{r codeblock1, echo = FALSE}
glimpse(expeditions)
```


```{r refiningData, echo = FALSE, warning= FALSE}
expeditions <- filter(expeditions, peak_name == "Cho Oyu")
```


## Model Building

Need 3 different models that measure 3 different explanatory variables for our response variable each. Need to brainstorm which models would be the best. 


```{r splittingData}
set.seed(3521)
#We can set the seed to whatever.
expeditions_split <- initial_split(expeditions, prop = 0.50)

expeditions_train <- training(expeditions_split)
expeditions_test <- testing(expeditions_split)
```
*This can be what we use for our 50-50 data split, we can change the seed as long as we keep it consistent. 


### Model 1
```{r model1, echo = FALSE, warning = FALSE}
Carter
```

Explanation


### Model Proposed by Jack

#### New Calculated Variables for Modeling

```{r calculated-variables}
m2_df <- expeditions %>% 
  mutate(trek = ifelse(is.na(trekking_agency), "No Agency", "Used Agency"))

m2_df <- m2_df %>% mutate(party_size = members + hired_staff)

set.seed(3521)

m2_df_split <- initial_split(m2_df, prop = 0.5)
m2_train <- training(m2_df_split)
m2_test <- testing(m2_df_split)
```

#### Party Size Bootstrap Visual

```{r party-size-bootstrap-dist}
m2_boot_df <- m2_train %>% specify(highpoint_metres ~ party_size) %>%
                generate(reps = 1000, type = "bootstrap") %>%
                calculate(stat = "slope")

ci_m2 <- m2_boot_df %>%
          get_confidence_interval(level = 0.95)
m2_boot_df %>% visualize() + shade_ci(endpoints = ci_m2)
```

#### Model

```{r model2, echo = FALSE, warning = FALSE}
m2_main_fit <- lm(highpoint_metres ~ party_size + trek + season, data=m2_train)
tidy(m2_main_fit)

glance(m2_main_fit) %>% select(r.squared, adj.r.squared)
```

#### Model Evaluation

```{r evaluate-m2}
hp_pred <- predict(m2_main_fit, newdata=m2_test) %>%
  bind_cols(m2_test %>% select(highpoint_metres) ) %>%
  rename(pred = ...1)

glimpse(hp_pred)

rmse(hp_pred, truth=highpoint_metres, estimate=pred)
```

#### Justification and Explanation

The goal of this model is to predict how high a given expedition will reach using the number of people in the expedition, whether the expedition was conducted through a trekking agency, and what season the expedition took place during. Above you will see the bootstrap distribution of party_size, showing that there is a positive correlation between this metric and highpoint. Season is included due to the large significance of weather conditions on a climb, summer has a very different set of conditions than winter does. Additionally the trek variable shows whether a trekking agency was used or not, the presence (or absence) of experienced guides can have a large effect on the outcome of an expedition. The model is described as follows:
highpoint (meters) = 7812 + 18.3(party size) - 64.1(if Used Agency) -87.2(if Spring) - 348.7(if Summer) - 100.8(if Winter). The RMSE of my model is 564.4 which indicates that there is a moderately large difference between the model's prediction and the actual value. A few hundred meters on an 8000 meter mountain isn't that big of a deal, but in a place as dangerous as the Himalayas even a centimeter counts.


### Model 3
```{r model3, echo = FALSE, warning = FALSE}
Alex
```

Explanation
